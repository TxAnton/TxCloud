	Задание на лабораторную работу N5 по дисциплине "Архитектура компьютера"      
        
	Тема: Написание собственного прерывания.
      
      1. Краткие сведения.
      
      Прерывание -  это  процесс  вызова процедур для выполнения
некоторой задачи,  обычно связанной  с  обслуживанием  некоторых
устройств  (обработка сигнала таймера,  нажатия клавиши и т.д.).
Когда возникает прерывание,  процессор прекращает выполнение те-
кущей  программы  (если  ее приоритет ниже) и запоминает в стеке
вместе с регистром флагов адрес возврата(CS:IP) - места, с кото-
рого будет продолжена прерванная программа. Затем в CS:IP загру-
жается адрес программы обработки прерывания и ей передается  уп-
равление. Адреса 256 программ обработки прерываний, так называе-
мые векторы прерывания,  имеют длину по 4 байта (в  первых  двух
хранится значение IP , во вторых - CS) и хранятся в младших 1024
байтах памяти.  Программа обработки прерывания  должна  заканчи-
ваться  инструкцией IRET (возврат из прерывания),  по которой из
стека восстанавливается адрес возврата и регистр флагов.
      Программа обработки  прерывания - это отдельная процедура,
имеющая структуру:
      
 SUBR_INT  PROC FAR
           PUSH AX   ; сохранение изменяемых регистров
            ...
           <действия по обработке прерывания>
           POP  AX   ; восстановление регистров
            ...
           MOV  AL, 20H
           OUT  20H,AL
           IRET
 SUBR_INT  ENDP
      
      Две последние  строки  необходимы для разрешения обработки
прерываний с более низкими уровнями,  чем только что  обработан-
ное.
      Замечание: в лабораторной работе действиями  по  обработке
прерывания может быть вывод на экран некоторого текста, вставка 
задержки в вывод сообщения или включение звукового сигнала.

      Программа, использующая новые программы обработки прерыва-
ний  при  своем  завершении  должна восстанавливать оригинальные
векторы прерываний. Функция 35 прерывания 21H возвращает текущее
значение вектора прерывания,  помещая значение сегмента в ES,  а
смещение в BX.  В этом случае программа должна содержать следую-
щие инструкции:

; -- в сегменте данных
      KEEP_CS DW 0 ; для хранения сегмента
      KEEP_IP DW 0 ; и смещения прерывания
      
; -- в начале программы
      MOV  AH, 35H   ; функция получения вектора
      MOV  AL, 1CH   ; номер вектора
      INT  21H
      MOV  KEEP_IP, BX  ; запоминание смещения
      MOV  KEEP_CS, ES  ; и сегмента
      
      Для установки написанного прерывания  в  поле  векторов
прерываний  используется  функция 25H прерывания 21H, которая
устанавливает вектор прерывания на указанный адрес.
      
      PUSH DS
      MOV  DX, OFFSET ROUT ; смещение для процедуры в DX
      MOV  AX, SEG ROUT    ; сегмент процедуры
      MOV  DS, AX          ; помещаем в DS
      MOV  AH, 25H         ; функция установки вектора
      MOV  AL, 60H         ; номер вектора
      INT  21H             ; меняем прерывание
      POP  DS
      
В конце программы программы восстанавливается старый вектор пре-
рывания

      CLI
      PUSH DS
      MOV  DX, KEEP_IP
      MOV  AX, KEEP_CS
      MOV  DS, AX
      MOV  AH, 25H
      MOV  AL, 1CH
      INT  21H          ; восстанавливаем вектор
      POP  DS
      STI
      

                          Варианты  заданий

     Шифры, определяющие варианты заданий приведены в таблице.


               ┌───────┬───────────┬───────┬───────────┐
               │   N   │   Шифр    │   N   │   Шифр    │
               │бригады│  задания  │бригады│  задания  │
               ├───────┼───────────┼───────┼───────────┤
               │   1   │    1A     │   8   │   3А      │
               │   2   │    1B     │   9   │   3В      │
               │   3   │    1C     │   10  │   3С      │
               │   4   │    2A     │   11  │   4А      │
               │   5   │    2B     │   12  │   4В      │
               │   6   │    2C     │   13  │   4С      │
               └───────┴───────────┴───────┴───────────┘
      
    Цифра  в шифре задает номер и назначение заменяемого вектора
прерывания:

       1 - 08h  - прерывание от системного таймера - генерируется автоматически
                  операционной системой 18 раз в сек;
       2 - 60h  - прерывание пользователя - должно генерироваться в программе;
       3 - 23h  - прерывание,  генерируемое  при  нажатии  клавиш Control+C;
       4 - 1Ch  - прерывание от часов - генерируется автоматически
                  операционной системой 18 раз в сек;

     Буква определяет действия, реализуемые программой обработки
прерываний:
       А -  Печать сообщения на экране;
       В -  Выдача звукового сигнала(печать символа с кодом 07h);
       С -  Приостановить вывод на экран (вставить цикл задержки).

Замечание: для исключения возможного взаимного влияния системных и
           пользовательских  прерываний  рекомендуется  отвести  в
           программе под стек не менее 1К байт.
