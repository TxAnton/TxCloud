          Ассемблер для IBM PC                                       1


          
          
          
          
                    АССЕМБЛЕР И ПРОГРАММИРОВАНИЕ ДЛЯ IBM PC
          
          
          
                              ПИТЕР АБЕЛЬ
          
                         Технологический институт
                         Британская Колумбия
          
          







































          
          Ассемблер для IBM PC                                       2


          
          Содержание
          ------------------------------------------------------------
          
          Предисловие
          
           1.  Введение в семейство персональных компьютеров IBM PC
          
                    Введение
                    Биты и байты
                    ASCII код
                    Двойные числа
                    Шеснадцатеричное представление
                    Сегменты
                    Регистры
                    Архитектура персональных компьютеров
                    Основные положения на память
                    Вопросы для самопроверки
          
           2.  Выполнение программы
          
                    Введение
                    Начало работы
                    Просмотр памяти
                    Пример машинных кодов: непосредственные данные
                    Пример машинных кодов: определенные данные
                    Машинная адресация
                    Пример машинных кодов: определение размера памяти
                    Свойства отладчика
                    Основные положения на память
                    Вопросы для самопроверки
          
           3.  Формат языка ассемблера
          
                    Введение
                    Комментарии
                    Формат кодирования
                    Псевдокоманды
                    Указатели памяти и регистров
                    Инициализация программы
                    Пример исходной программы
                    Основные положения на память
                    Вопросы для самопроверки
          
           4.  Ассемблирование и выполнение программы
          
                    Введение
                    Ввод программы
                    Подготовка программы для выполнения
                    Ассемблирование программы
                    Компановка загрузочного модуля
                    Выполнение программы
                    Пример исходной программы

          
          Ассемблер для IBM PC                                       3


                    Файл перекрестных ссылок
                    Основные положения на память
                    Вопросы для самопроверки
          
           5.  Определение данных
          
                    Введение
                    Псевдокоманды определения данных
                    Определение байта (DB)
                    Определение слова (DW)
                    Определение двойного слова (DD)
                    Определение "четверного" слова (DQ)
                    Определение десяти байт (DT)
                    Непосредственные операнды
                    Псевдокоманда (директива) EQU
                    Основные положения на память
                    Вопросы для самопроверки
          
           6.  Программные COM-файлы
          
                    Введение
                    Различия между EXE- и COM-файлами
                    Пример COM-файла
                    COM-стек
                    Отладка
                    Основные положения на память
                    Вопросы для самопроверки
          
           7.  Логика и организация программы
          
                    Введение
                    Команда JMP
                    Команда LOOP
                    Флаговый регистр
                    Команды условного перехода
                    Процедуры и вызовы (CALL)
                    Стековый сегмент
                    Программа: команды длинной пересылки
                    Логические команды: AND, OR, XOR, TEST, NOT
                    Программа: изменение нижнего и верхнего регистров
                    Сдвиги и ротация
                    Организация программы
                    Основные положения на память
                    Вопросы для самопроверки
          
           8.  Работы с экраном I: Основные возможности
          
                    Введение
                    Команда прерывания: INT
                    Установка курсора
                    Очистка экрана
                    Команды экрана и клавиатуры: Базовая DOS
                    Ввод на экран: стандарт DOS

          
          Ассемблер для IBM PC                                       4


                    Программа: Ввод набора ASCII символов
                    Ввод с клавиатуры: Базовая DOS
                    Программа: Ввод имен с клавиатуры и вывод на экран
                    Команды экрана и клавиатуры: Расширенная DOS
                    Вывод на экран: Расширенная DOS
                    Ввод с клавиатуры: Расширенная DOS
                    Использование CR, LF, TAB для вывода на экран
                    Основные положения на память
                    Вопросы для самопроверки
          
           9.  Работа с экраном II: Расширенные возможности
          
                    Введение
                    Байт атрибутов
                    Прерывания BIOS
                    Программа: мигание, видеореверс, скроллинг
                    Расширенные ASCII коды
                    Другие команды ввода/вывода DOS
                    BIOS INT 16H для ввода с клавиатуры
                    Дополнительные функциональные клавиши
                    Основные положения на память
                    Вопросы для самопроверки
          
          10.  Работа с экраном III: Цвет и графика
          
                    Введение
                    Текстовый (алфавитно-цифровой) режим
                    Графический режим
                    Режим средней разрешающей возможности
                    Программа: Установка цвета и графического режима
                    Основные положения на память
                    Вопросы для самопроверки
          
          11.  Обработка строк
          
                    Введение
                    Особенности команд обработки строк
                    REP: Префикс повторения строки
                    MOVS: Пересылка строки
                    LODS: Загрузка строки
                    STOS: Сохранение строки
                    CMPS: Сравнение строк
                    SCAS: Сканирование строки
                    Сканирование и замена
                    Альтернативное кодирование
                    Дублирование шаблона (образца)
                    Программа: Выравнивание справа при выводе на экран
                    Основные положения на память
                    Вопросы для самопроверки
          
          12.  Арифметика I: Обработка двоичных данных
          
                    Введение

          
          Ассемблер для IBM PC                                       5


                    Сложение и вычитание
                    Беззнаковые и знаковые данные
                    Умножение
                    Сдвиг регистров DX:AX
                    Деление
                    Преобразование знака
                    Процессоры Intel 8087 и 80287
                    Основные положения на память
                    Вопросы для самопроверки
          
          13. Арифметика II: Обработка ASCII и BCD данных
          
                    Введение
                    ASCII формат
                    Двоично-десятичный формат (BCD)
                    Преобразование ASCII формата в двоичный формат
                    Преобразование двоичного формата в ASCII формат
                    Сдвиг и округление
                    Программа: Расчет зарплаты
                    Основные положения на память
                    Вопросы для самопроверки
          
          14.  Обработка таблиц
          
                    Введение
                    Определение таблиц
                    Прямой табличный доступ
                    Поиск в таблице
                    Команда перекодировки (трансляции) (XLAT)
                    Программа: Вывод шестнадцатеричных и ASCII кодов
                    Программа: Сортировка элементов таблицы
                    Операторы TYPE, LENGTH и SIZE
                    Основные положения на память
                    Вопросы для самопроверки
          
          15.  Дисковая память I: Организация
          
                    Введение
                    Объем диска
                    Каталог
                    Таблица распределения файлов (FAT)
                    Основные положения на память
                    Вопросы для самопроверки
          
          16.  Дисковая память II: Функции базовой DOS
          
                    Введение
                    Управляющий блок файла: FCB
                    Использование FCB для создания дискового файла
                    Программа: FCB для создания дискового файла
                    Последовательное чтение дискового файла
                    Программа: FCB для чтения дискового файла
                    Прямой доступ

          
          Ассемблер для IBM PC                                       6


                    Программа: Прямое чтение дискового файла
                    Прямой блочный доступа
                    Программа: Прямое чтение блока
                    Абсолютный дисковый ввод/вывод
                    Другие возможности
                    Программа: Выборочное удаление файлов
                    Основные положения на память
                    Вопросы для самопроверки
          
          17.  Дисковая память III: Функции расширенной DOS
          
                    Введение
                    Строка ASCIIZ
                    Номер файла и коды возврата по ошибкам
                    Создание дискового файла
                    Программа: Использование номера для чтения файла
                    ASCII файлы
                    Другие функции расширенной DOS
                    Основные положения на память
                    Вопросы для самопроверки
          
          18.  Дисковая память IV: Команды ввода/вывода BIOS
          
                    Введение
                    Дисковые команды BIOS
                    Байт состояния
                    Программа: Использование BIOS для чтения секторов
                    Основные положения на память
                    Вопросы для самопроверки
          
          19.  Печать
          
                    Введение
                    Управляющие символы для печати
                    Использование расширенной DOS для печати
                    Программа: Постраничная печать с заголовками
                    Печать ASCII файлов и управление табуляций
                    Печать с использованием базовой DOS
                    Специальные команды принтера
                    Печать с использованием BIOS INT 17H
                    Основные положения на память
                    Вопросы для самопроверки
          
          20.  Макрокоманды
          
                    Введение
                    Простое макроопределение
                    Использование параметров в макрокомандах
                    Комментарии
                    Использование макро внутри макроопределения
                    Директива LOCAL
                    Подключение библиотеки макроопределений
                    Конкатенация (&)

          
          Ассемблер для IBM PC                                       7


                    Повторение: REPT, IRP и IRPC
                    Условные директивы
                    Директива EXITM
                    Макрокоманды, использующие IF и IFNDEF условия
                    Макрокоманды, использующие IFIDN условие
                    Основные положения на память
                    Вопросы для самопроверки
          
          21.  Связь между подпрограммами
          
                    Введение
                    Межсегментные вызовы
                    Атрибуты EXTRN и PUBLIC
                    Программа: Использование EXTRN и PUBLIC для меток
                    Программа: Использование PUBLIC в кодовом сегменте
                    Программа: Общие данные в подпрограммах
                    Передача параметров
                    Связь Бейсик-интерпритатор - ассемблер
                    Связь Паскаль - ассемблер
                    Связь C - ассемблер
                    Основные положения на память
                    Вопросы для самопроверки
          
          22.  Загрузчик программ
          
                    Введение
                    COMМAND.COM
                    Префикс программного сегмента
                    Выполнение COM-программы
                    Выполнение EXE-программы
                    Пример EXE-программы
                    Функция загрузки или выполнения программ
          
          23.  BIOS и DOS прерывания
          
                    Введение
                    Обслуживание прерываний
                    BIOS прерывания
                    DOS прерывания
                    Функции DOS INT 21H
                    Резидентные программы
                    Порты
                    Генерация звука
          
          24.  Справочник по директивам ассемблера
          
                    Введение
                    Индексная память
                    Команды ассемблера
                    Директивы ассемблера
          
          25.  Справочник по командам ассемблера
          

          
          Ассемблер для IBM PC                                       8


                    Введение
                    Обозначение регистров
                    Байт режима адресации
                    Двухбайтовые команды
                    Трехбайтовые команды
                    Четырехбайтовые команды
                    Команды в алфавитном порядке
          
          Приложения
          
                    1.   ASCII коды
                    2.   Шестнадцатерично-десятичные преобразования
                    3.   Зарезервированные слова
                    4.   Режимы ассемблирования и компановки
          
          Ответы на некоторые вопросы
          
          Индексный указатель




































          
          Ассемблер для IBM PC                                       9


          ------------------------------------------------------------
          
          Предисловие
          
             Появление микропроцессоров в 60-х  годах cвязано  с разра
          боткой интегральных схем (ИС). Интегральные схемы объединяли
          в себе различные элэктронные компоненты в  единый элемент на
          силиконовом "чипе".  Разработчики установили  этот крошечный
          чип в устройство,  напоминающие сороконожку и включили его в
          функционирующие системы.  В начале  70-х  микрокомпьютеры на
          процессоре  Intel 8008  возвестили о  первом поколении микро
          процессоров.
             К 1974  году появилось  второе поколение микропроцессоров
          oбщего назначения  Intel 8080.  Данный успех  побудил другие
          фирмы к производству этих или аналогичных процессоров.
             В  1978  году  фирма Intel  выпустила  процессор третьего
          поколения - Intel 8086, который обеспечивал некоторую совмес
          тимость с 8080  и являлся значительным продвижением вперед в
          данной области. Для поддержки более простых устройств и обес
          печения  совместимости  с  устройствами   ввода/вывода  того
          времени  Intel разработал  разновидность  процессора  8086 -
          процессор 8088,  который в  1981  году был выбран фирмой iВМ
          для ее персональных компьютеров.
             Более развитой версией процессора 8088 является процесcор
          80188,  а  для процессора  8086  - процессоры 80186, 80286 и
          80386,  которые обеспечили дополнительные возможности и повы
          cили  мощность вычислений.  Микропроцессор 80286, установлен
          ный в компьютерах IBM  AT  появился  в  1984  году.  Все эти
          процессоры  имеют отношение к развитой  архитектуре процессо
          ров фирмы Intel и обозначаются  как iAPX  86,  iAPX 88, iAPX
          86,  iAPX286  и iAPX386,  где APX - Intel Advanced Processor
          Architecture.
             Распространение микрокомпьютеров послужило  причиной пеpе
          смотра отношения к языку ассемблера  по  двум основным причи
          нам.  Во-первых,  программы, написанные на языке ассемблера,
          требуют  значительно  меньше  памяти  и  времени выполнения.
          Во-вторых,  знание языка ассемблера  и результирующего машин
          ного кода  дает  понимание архитектуры машины,  что  вряд ли
          обеспечивается  при работе  на  языке высокого  уровня. Хотя
          большинство специалистов в  области программного обеспечения
          ведут  разработки  на  языках  высокого  уровня,  таких  как
          Паскаль  или С,  что проще при написании  программ, наиболее
          мощное  и эффективное программное обеспечение  полностью или
          частично написано на языке ассемблера.
             Языки  высокого  уровня были разработаны для  того, чтобы
          избежать  специальной  технической   особенности  конкретных
          компьютеров. Язык ассемблера, в свою очередь, разработан для
          конкретной специфики  компьютера  или  точнее  для специфики
          процессора.  Следовательно, для того, чтобы написать програм
          му на  языке ассемблера для  конкретного компьютера, следует
          знать его архитектуру и данная книга содержит  весь необходи
          мый  базовый материал.  Для  работы кроме  этого материала и
          cоответствующих знаний необходимы следующее:

          
          Ассемблер для IBM PC                                      10


             
             ▀ Доступ персональному компьютеру IBM PC или совместимому
               с ним c оперативной памятью - минимум 64К и одним диско
               водом.  Лучше,  но не  обязательно,  если будет дополни
               тельная память и второй дисковод или винчестер.
             
             ▀ Знакомство с руководством по IBM PC.
             
             ▀ Дискета, содержащая транслятор с языка ассемблера, пред
               почтительно, но не обязательно, последней версии.
             
             ▀ Копию операционной системы PC-DOS или MS-DOS, лучше пос
               ледней версии.
             
             Cледующее является не обязательным для данной темы:
             
             ▀ Опыт программирования.  Хотя  эти  знания  могут помочь
               быстрее  освоить некоторые  идеи  программирования, они
               не обязательны.
             
             ▀ Хорошие  знания в электронике  или схемотехнике. Данная
               книга  дает  всю необходимую информацию  об архитектуре
               PC,  которая  требуется для  программирования  на языке
               ассемблера.
             
             
             Операционные системы
             
             Назначение операционной системы  - позволить пользователю
          yправлять  работой на  компьютере:  вызывать  для выполнения
          конкретные  программы,  обеспечивать средства для сохранения
          данных (каталог), иметь доступ к информации на диске.
             Основной операционной системой  для PC  и совместимых мо-
          делей является MS-DOS фирмы Microsoft,  известная как PC-DOS
          для IBM  PC.  Особенности некоторых версий: 2.0 обеспечивает
          поддержку  твердого  диска (винчестера),  3.0  применяется в
          компьютерах AT,  4.0 обеспечивает работу в многопользователь
          ском  режиме.   Рассмотрение  профессиональной  операционной
          системы UNIX  и ее  аналога для PC  XENIX  выходит  за рамки
          данной книги.
             
             Подход к книге
             
             Данная книга приследует две цели: она является учебником,
          a  так же  постоянным справочным пособием  для работы. Чтобы
          наиболее  эффективно восполнить затраты на  микрокомпьютер и
          программное обеспечение,  необходимо тщательно прорабатывать
          каждую главу и перечитывать материал, котоpый не сразу ясен.
          Ключевые моменты находятся в примерах  программ,  их следует
          преобразовать   в   выполнимые   модули   и   выполнить  их.
          Прорабатывайте упражнения, приведенные в конце каждой главы.



          
          Ассемблер для IBM PC                                      11


             Первые восемь глав составляют базовый материал для данной
          книги  и  для  языка  ассемблера.   После  этих  глав  можно
          продолжить с  глав  9,  11,  12,  14,  15,  19,  20  или 21.
          Связанными являются главы с 8  по 10,  12  и 13, с 15 по 18,
          главы с 22 по 25 cодержат справочный материал.
             Когда вы завертшите работу с книгой, вы сможете:
             
             - понимать хардвер персонального компьютера;
             - понимать коды машинного языка и шестнадцатиричный
               формат;
             - понимать назначение отдельных шагов при ассемблирова
               нии, компановке и выполнении;
             - писать программы на языке ассемблера для управления
               экраном, арифметических действий, преобразования ASCII
               кодов в двоичные форматы, табличного поиска и сортиро
               вки, дисковых операций ввода/вывода;
             - выполнять трассировку при выполнении программы, как
               средство отладки;
             - писать собственные макрокоманды;
             - компановать вместе отдельные программы.
             
             Изучение языка ассемблера и  создание работающих программ
          -  это захватывающий  процесс.  Затраченное  время  и усилия
          несомненно будут вознаграждены.
             
             Признательность автора
             
             Автор  благодарен  за  помощь и  сотрудничество всем, кто
          внес предложения и просматривал рукопись.

























          
          Ассемблер для IBM PC                                      12


          
          Предисловие переводчика
          
             Книга  представляет собой учебник  по программированию на
          языке Ассемблера для персональных компьютерах, совместимых с
          IBM PC,  адресованный прежде всего  начинающим. Обилие приме
          ров и  исходных  текстов  программ  представляет несомненное
          достоинство   книги,   позволяющее   начинать   практическое
          программирование  уже с первых  страниц книги. Профессиональ
          ные  программисты  смогут  найти  в  книге   много  полезной
          информации.  Стиль книги очень живой,  простой, не требующий
          никакой   специальной    или    математической   подготовки.
          Единственное,  что необходимо  для работы над  книгой, - это
          постоянный доступ к персональному компьютеру.
             Переводчик  в  основном  придерживался  терминологии книг
          В.М.Брябрина  "Программное  обеспечение   персональных  ЭВМ"
          (1988),  С.Писарева,  Б.Шура "Программно-аппаратная организа
          ция  компьютера IBM PC"  (1987), В.Л.Григорьева "Программиро
          вание  однокристальных  микропроцессоров"  (1987),  а  также
          А.Б.Борковского "Англо-русский словарь по программированию и
          информатике"    (1987).   Во   многих   случаях   переводчик
          придерживался   "профессионального   диалекта"   максимально
          щадящего  технические  термины  в  оригинале.  Такой диалект
          принят  во  многих  коллективах программистов-разработчиков,
          где   чаще   всего   приходится   работать   с  оригинальной
          документацией   на   английском   языке,   ввиду  острейшего
          дефицита отечественной литературы по данной тематике.
             Большинство   примеров,   приведенных   в  данной  книге,
          проверены на компьютерах совместимых с IBM  PC. При переводе
          без  специальных  оговорок  исправлены  мелкие  неточности и
          опечатки оригинала.
             Текст  перевода сформирован и  отредактирован в интегриро
          ванной системе Framework.
             Автор  перевода  благодарен  всем,  кто оказал помощь при
          вводе рукописи на машинные носители.  Особую признательность
          автор перевода выражает своей жене.


















          
